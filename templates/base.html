<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirHost Pro - MIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF385C',
                        neutral: '#222222',
                        border: '#DDDDDD',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-[#F8F9FA] text-[#222222] antialiased min-h-screen flex flex-col">
    <!-- Navbar -->
    <nav class="border-b border-gray-200 sticky top-0 bg-white/80 backdrop-blur-md z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-18 items-center py-4">
                <div class="flex items-center gap-10">
                    <!-- Logo -->
                    <a href="/" class="flex items-center gap-2 group">
                        <div class="w-8 h-8 text-primary group-hover:scale-110 transition-transform duration-200">
                            <svg viewBox="0 0 24 24" fill="currentColor" class="w-full h-full">
                                <path d="M12 2L3 11H5V21H10V14H14V21H19V11H21L12 2Z" />
                            </svg>
                        </div>
                        <span class="text-xl font-bold text-primary tracking-tight">AirHost Pro</span>
                    </a>

                    <!-- Links -->
                    <div class="hidden md:flex items-center space-x-8">
                        <a href="/"
                            class="text-sm font-medium hover:text-primary transition-colors {{ 'text-neutral border-b-2 border-neutral' if active_page == 'dashboard' else 'text-gray-500' }} py-1">Dashboard</a>
                        <a href="/properties"
                            class="text-sm font-medium hover:text-primary transition-colors {{ 'text-neutral border-b-2 border-neutral' if active_page == 'properties' else 'text-gray-500' }} py-1">Properties</a>
                        <a href="/calendar"
                            class="text-sm font-medium hover:text-primary transition-colors {{ 'text-neutral border-b-2 border-neutral' if active_page == 'calendar' else 'text-gray-500' }} py-1">Calendar</a>
                        <a href="/reports"
                            class="text-sm font-medium hover:text-primary transition-colors {{ 'text-neutral border-b-2 border-neutral' if active_page == 'reports' else 'text-gray-500' }} py-1">Reports</a>
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <!-- Notifications -->
                    <div class="relative">
                        <button onclick="toggleDropdown('notifDropdown')"
                            class="p-2 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100 relative focus:outline-none transition-colors">
                            <i data-lucide="bell" class="w-5 h-5"></i>
                            <span
                                class="absolute top-2 right-2 w-2 h-2 bg-primary rounded-full border border-white"></span>
                        </button>
                        <!-- Dropdown -->
                        <div id="notifDropdown"
                            class="absolute right-0 mt-2 w-80 bg-white rounded-2xl shadow-xl border border-gray-100 hidden z-50 animate-fade-in p-4 origin-top-right">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-bold text-neutral">Notifications</h3>
                                <button onclick="markAllRead()"
                                    class="text-xs text-primary cursor-pointer hover:underline">Mark all read</button>
                            </div>
                            <div class="space-y-2 max-h-60 overflow-y-auto" id="notificationList">
                                {% if notifications %}
                                {% for notif in notifications %}
                                <div
                                    class="flex gap-3 items-start p-2 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer border-l-2 {{ 'border-primary' if not notif.read else 'border-transparent' }}">
                                    <div class="p-1.5 bg-yellow-50 text-yellow-600 rounded-lg shrink-0">
                                        <i data-lucide="{{ 'zap' if notif.type == 'booking' else 'alert-circle' }}"
                                            class="w-4 h-4"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-neutral">{{ notif.message }}</p>
                                        <p class="text-xs text-gray-500">Just now</p>
                                    </div>
                                </div>
                                {% endfor %}
                                {% else %}
                                <p class="text-xs text-gray-400 text-center py-4">No new notifications</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Profile -->
                    <div class="relative">
                        <div onclick="toggleDropdown('profileDropdown')"
                            class="w-9 h-9 rounded-full bg-gray-200 border border-gray-300 overflow-hidden cursor-pointer hover:ring-2 hover:ring-primary hover:ring-offset-2 transition-all">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Manager" alt="User">
                        </div>
                        <!-- Dropdown -->
                        <div id="profileDropdown"
                            class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-100 hidden z-50 animate-fade-in py-1 origin-top-right">
                            <a href="/settings"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-primary transition-colors">Profile
                                Settings</a>
                            <a href="/billing"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-primary transition-colors">Billing</a>
                            <div class="border-t border-gray-100 my-1"></div>
                            <a href="/login"
                                class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">Sign
                                Out</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="mb-6 space-y-2">
            {% for category, message in messages %}
            <div
                class="p-4 rounded-xl border {{ 'bg-green-50 border-green-200 text-green-700' if category == 'success' else 'bg-red-50 border-red-200 text-red-700' }} flex justify-between items-center animate-fade-in">
                <div class="flex items-center gap-2">
                    <i data-lucide="{{ 'check-circle' if category == 'success' else 'alert-circle' }}"
                        class="w-5 h-5"></i>
                    <span class="font-medium">{{ message }}</span>
                </div>
                <button onclick="this.parentElement.remove()" class="hover:opacity-75"><i data-lucide="x"
                        class="w-4 h-4"></i></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="border-t border-gray-200 py-8 bg-white mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-400 text-sm">
            <p>&copy; 2025 AirHost Pro MIS. Designed for Excellence.</p>
        </div>
    </footer>

    <script>
        lucide.createIcons();

        function toggleModal(modalID) {
            const modal = document.getElementById(modalID);
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            } else {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        }

        function toggleDropdown(dropdownID) {
            const dropdown = document.getElementById(dropdownID);

            // Close other dropdowns first
            ['notifDropdown', 'profileDropdown'].forEach(id => {
                if (id !== dropdownID) {
                    document.getElementById(id).classList.add('hidden');
                }
            });

            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
            } else {
                dropdown.classList.add('hidden');
            }
        }

        // Close dropdowns when clicking outside
        window.addEventListener('click', function (e) {
            if (!e.target.closest('.relative')) {
                document.getElementById('notifDropdown').classList.add('hidden');
                document.getElementById('profileDropdown').classList.add('hidden');
            }
        });

        function markAllRead() {
            fetch('/api/notifications/mark_read', { method: 'POST' })
                .then(r => r.json())
                .then(data => {
                    const list = document.getElementById('notificationList');
                    list.innerHTML = '<p class="text-xs text-gray-400 text-center py-4">No new notifications</p>';
                    // Also remove badge
                    const badge = document.querySelector('button .bg-primary.rounded-full');
                    if (badge) badge.classList.add('hidden');
                });
        }
    </script>
</body>

</html>